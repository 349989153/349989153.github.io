<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>《js函数式编程》读书笔记 | 陆扬的个人博客</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><script src="/js/third-party/jquery.min.js">           </script><script src="/js/third-party/velocity.min.js">           </script><script src="/js/third-party/velocity.ui.min.js">           </script><link rel="icon" href="/img/favicon.ico"></head><body><nav id="nav-bar"><nav class="clear-fix" id="nav-container"><div class="pull-left" id="page-home"><a href="/">陆扬的个人博客</a></div><i class="fa fa-bars pull-right" id="toggle-nav" aria-hidden="true"></i><ul class="pull-right" id="navs"><li><a class="nav" href="/">Home</a></li><li><a class="nav" href="/about">About</a></li><li><a class="nav" href="/tags">Tags</a></li><li><a class="nav" href="/categories">Categories</a></li></ul></nav></nav><header id="header-info"><div id="header-container"><div id="site-info"><div id="terminal-pl"><div id="top-bar"><ul id="control"><li class="btn"></li><li class="btn"></li><li class="btn"></li></ul><div id="file-path"><i class="fa fa-folder folder-ic" aria-hidden="true"></i> 349989153 10 X 10</div></div><div id="code-pl">Last updated: 2018-04-10<br>349989153:~ Desktop$ <span class="code-pl-input">node 《js函数式编程》读书笔记.js</span><br><br>> Post.tags <br><a class="tag" href="#js"><span>js</span></a><a class="tag" href="#编程范式"><span>编程范式</span></a><a class="tag" href="#读书"><span>读书</span></a><a class="tag" href="#函数式"><span>函数式</span></a><br><br>> Post.next <br><a href="/2018/04/10/NodeJS验证微信开发平台的token/"><span class="answer">NodeJS验证微信开发平台的token</span></a></div></div></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><a class="article-title">《js函数式编程》读书笔记</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><p>阅读《Javascript函数式编程》时做的笔记。</p>
<a id="more"></a>
<hr>
<h1 id="胡乱说话"><a href="#胡乱说话" class="headerlink" title="胡乱说话"></a>胡乱说话</h1><p>什么是高阶函数，什么是阶？</p>
<p>函数可以返回函数，这就是高阶函数；被返回的函数里又可以返回函数，每返回一次就叫做一阶。</p>
<p>为什么需要高阶函数？</p>
<p>每一阶执行的时候，我们都可以往里填上参数，使其更细节；即使不填入参数，我们也能写一些语句，使得下一阶函数的细节更具体。</p>
<p>比如我们理解<code>redux-thunk</code>中的<code>index.js</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createThunkMiddleware</span>(<span class="params">extraArgument</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">&#123; dispatch, getState &#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> action(dispatch, getState, extraArgument);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next(action);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>createThunkMiddleware</code>返回一个函数，这个函数又返回一个函数，又返回一个函数，又返回一个函数……噢天呐，别说理解，看明白这个都要花上好半天。</p>
<p>但是我们按照之前阶的概念来理解，每返回一个函数，就是一阶，并且这一阶一定做了什么不一样的事情，那么我们就可以列出来这样一个表：</p>
<ul>
<li>第一阶：有或没有额外参数</li>
<li>第二阶：传入<code>store</code>的<code>dispatch</code>和<code>getState</code></li>
<li>第三阶：传入之前所做的其他变换（next）</li>
<li>第四阶：传入action</li>
</ul>
<p><strong>高阶的本质：为下一阶的执行提供上下文。而上下文，是解释某个概念的含义和用途。</strong></p>
<p>所以上面那段代码段，用这个思路去解释的话，就是：</p>
<blockquote>
<p>如果<code>action</code>是函数，那么调用<code>action</code>给他传入<code>dispatch</code>，<code>getState</code>，和<code>extraArgument</code>；否则，直接返回<code>next</code>对<code>action</code>的执行结果。</p>
</blockquote>
<p><code>extraArgument</code>是什么？第一个函数执行后搞定。<code>dispatch</code>和<code>getState</code>是什么？第二个函数执行后搞定。<code>next</code>是什么？第三个函数执行后搞定，<code>action</code>是什么？第四个函数执行后搞定。</p>
<p><strong>把要搞定的东西说成一句话，这叫需求；把自然语言的这一句话，转化成代码，这叫编程；把自然语言的这一句话，里面需要的各个元素，用函数慢慢地一个个注入进去，这叫函数式编程。</strong></p>
<hr>
<h1 id="用函数式思维重构代码"><a href="#用函数式思维重构代码" class="headerlink" title="用函数式思维重构代码"></a>用函数式思维重构代码</h1><p>“可变的地方，我们用函数把参数注入进去”，是上一节最后一句话的缩略版，我打算用这个思路把之前的代码重构一下。在我们app的代码里，有如下的代码：</p>
<blockquote>
<p>获取今天的日期，然后输出“2017年9月”等</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getCurrentYearMonth = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">const</span> year = date.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;year&#125;</span>年<span class="subst">$&#123;month&#125;</span>月`</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>获取今天的日期，然后返回数组[年，月，日]，其中月、日小于10的话就补0</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getTodayStringArray = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">const</span> year = time.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = time.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> date = time.getDate();</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    year,</span><br><span class="line">    month &lt; <span class="number">10</span> ? <span class="string">'0'</span> + month : month,</span><br><span class="line">    date &lt; <span class="number">10</span> ? <span class="string">'0'</span> + date : date</span><br><span class="line">  ];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回今天加或减num天的日期数组。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getDayStringArray = <span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!num || <span class="keyword">typeof</span> num !== <span class="string">'number'</span>) &#123;</span><br><span class="line">    num = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  time.setDate(time.getDate() + num); <span class="comment">//设置日期</span></span><br><span class="line">  <span class="keyword">const</span> year = time.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = time.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> date = time.getDate();</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    year,</span><br><span class="line">    month &lt; <span class="number">10</span> ? <span class="string">'0'</span> + month : month,</span><br><span class="line">    date &lt; <span class="number">10</span> ? <span class="string">'0'</span> + date : date</span><br><span class="line">  ];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回今天的字符串，如”20170201”</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getTodayString = <span class="function"><span class="params">()</span> =&gt;</span> getTodayStringArray().join(<span class="string">''</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>给8位日期字符加上短横线。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> joinDayStringWithHyphen = <span class="function"><span class="params">dayString</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> year = dayString.slice(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="keyword">const</span> month = dayString.slice(<span class="number">4</span>, <span class="number">6</span>);</span><br><span class="line">  <span class="keyword">const</span> day = dayString.slice(<span class="number">6</span>, <span class="number">8</span>);</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span>;</span><br><span class="line">  result += year;</span><br><span class="line">  <span class="keyword">if</span> (month) &#123;</span><br><span class="line">    result += <span class="string">'-'</span> + month;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (day) &#123;</span><br><span class="line">    result += <span class="string">'-'</span> + day;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="思考时间"><a href="#思考时间" class="headerlink" title="思考时间"></a>思考时间</h2><p>看着头有点大，因为这几条代码粗看好像相同，细看却又不一样，总而言之就是四个字，有点恶心。现在我们梳理一下，我们对于日期的需求：</p>
<ol>
<li><strong>获取日期对象</strong>，这个日期对象可能是今天，也可能是今天加减num天。</li>
<li><strong>把日期对象划分成一个数组</strong>，[年，月，日，时，分，秒]</li>
<li><strong>对于数组里面的各个元素进行处理</strong>，比如除了“年“之外，其他小于0的要补前置0。</li>
<li><strong>划分输出范围</strong>，比如有时候要输出年月，有时候要输出年月日，有时候只需要输出时分秒。</li>
<li><strong>加上连接词</strong>，比如有的要“年”和“月”，有的要短横线，有的什么都不要</li>
</ol>
<p>除了第2条之外，其他的需求都是比较有操作空间的，所以来写代码吧！这次我们要写的可不是什么垃圾，而是集数种日期需求于一身的“要你命三千的时间处理”，命名为timeKing马马虎虎啦。</p>
<h2 id="编码时间"><a href="#编码时间" class="headerlink" title="编码时间"></a>编码时间</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeKing = <span class="function"><span class="params">dateObject</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 输入必须为date对象。</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(dateObject) !== <span class="string">'[object Date]'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'parameter must be a date Object'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> year = dateObject.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = dateObject.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> date = dateObject.getDate();</span><br><span class="line">  <span class="keyword">const</span> hour = dateObject.getHours();</span><br><span class="line">  <span class="keyword">const</span> min = dateObject.getMinutes();</span><br><span class="line">  <span class="keyword">const</span> sec = dateObject.getSeconds();</span><br><span class="line">  <span class="keyword">const</span> array = [year, month, date, hour, min, sec];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后针对需求3写代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeKing = <span class="function"><span class="params">dateObject</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 输入必须为date对象。</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(dateObject) !== <span class="string">'[object Date]'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'parameter must be a date Object'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> year = dateObject.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = dateObject.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> date = dateObject.getDate();</span><br><span class="line">  <span class="keyword">const</span> hour = dateObject.getHours();</span><br><span class="line">  <span class="keyword">const</span> min = dateObject.getMinutes();</span><br><span class="line">  <span class="keyword">const</span> sec = dateObject.getSeconds();</span><br><span class="line">  <span class="keyword">const</span> array = [year, month, date, hour, min, sec];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">handlerForArrayItem</span> =&gt;</span> &#123;<span class="comment">// 对于数组里面的各个元素进行处理</span></span><br><span class="line">    <span class="keyword">if</span> (handlerForArrayItem === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      handlerForArrayItem = <span class="function"><span class="params">arg</span> =&gt;</span> arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handledArray = handlerForArrayItem(array);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后针对需求4写代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeKing = <span class="function"><span class="params">dateObject</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 输入必须为date对象。</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(dateObject) !== <span class="string">'[object Date]'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'parameter must be a date Object'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> year = dateObject.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = dateObject.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> date = dateObject.getDate();</span><br><span class="line">  <span class="keyword">const</span> hour = dateObject.getHours();</span><br><span class="line">  <span class="keyword">const</span> min = dateObject.getMinutes();</span><br><span class="line">  <span class="keyword">const</span> sec = dateObject.getSeconds();</span><br><span class="line">  <span class="keyword">const</span> array = [year, month, date, hour, min, sec];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">handlerForArrayItem</span> =&gt;</span> &#123;<span class="comment">// 对于数组里面的各个元素进行处理</span></span><br><span class="line">    <span class="keyword">if</span> (handlerForArrayItem === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      handlerForArrayItem = <span class="function"><span class="params">arg</span> =&gt;</span> arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handledArray = handlerForArrayItem(array);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">outputRange</span> =&gt;</span> &#123;<span class="comment">// 划分输出范围</span></span><br><span class="line">      <span class="keyword">if</span> (outputRange === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        outputRange = <span class="function"><span class="params">arg</span> =&gt;</span> arg</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> rangedArray = outputRange(handledArray);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>最后针对需求5写代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeKing = <span class="function"><span class="params">dateObject</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 输入必须为date对象。</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(dateObject) !== <span class="string">'[object Date]'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'parameter must be a date Object'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> year = dateObject.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = dateObject.getMonth() + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> date = dateObject.getDate();</span><br><span class="line">  <span class="keyword">const</span> hour = dateObject.getHours();</span><br><span class="line">  <span class="keyword">const</span> min = dateObject.getMinutes();</span><br><span class="line">  <span class="keyword">const</span> sec = dateObject.getSeconds();</span><br><span class="line">  <span class="keyword">const</span> array = [year, month, date, hour, min, sec];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">handlerForArrayItem</span> =&gt;</span> &#123;<span class="comment">// 对于数组里面的各个元素进行处理</span></span><br><span class="line">    <span class="keyword">if</span> (handlerForArrayItem === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      handlerForArrayItem = <span class="function"><span class="params">arg</span> =&gt;</span> arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handledArray = handlerForArrayItem(array);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">outputRange</span> =&gt;</span> &#123;<span class="comment">// 划分输出范围</span></span><br><span class="line">      <span class="keyword">if</span> (outputRange === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        outputRange = <span class="function"><span class="params">arg</span> =&gt;</span> arg</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> rangedArray = outputRange(handledArray);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">conjunction</span> =&gt;</span> &#123;<span class="comment">// 加上连接词。</span></span><br><span class="line">        <span class="keyword">if</span> (conjunction === <span class="literal">undefined</span>) &#123;</span><br><span class="line">          conjunction = <span class="function"><span class="params">arg</span> =&gt;</span> arg.join(<span class="string">''</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> conjunction(rangedArray);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个…时间处理王中王怎么用呢，emmmm:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeKing(<span class="comment">/* 时间对象 */</span>)(<span class="comment">/* 对每个元素做处理 */</span>)(<span class="comment">/* 划分输出的范围 */</span>)(<span class="comment">/* 加上连接词 */</span>);</span><br></pre></td></tr></table></figure>
<h2 id="测试时间"><a href="#测试时间" class="headerlink" title="测试时间"></a>测试时间</h2><p>还是看看用这个王中王怎么实现我们之前的需求吧。</p>
<blockquote>
<p>获取今天的日期，然后输出“2017年9月”等</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> addFrontZero = <span class="function"><span class="params">number</span> =&gt;</span> +number &lt; <span class="number">10</span> ? <span class="string">'0'</span> + number : <span class="string">''</span> + number;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addFrontZeroHandler = <span class="function"><span class="params">array</span> =&gt;</span> array.map(<span class="function">(<span class="params">item, idx</span>) =&gt;</span> item &gt;= <span class="number">1970</span> ? item : addFrontZero(item));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CNConjunction = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> array.map(<span class="function">(<span class="params">item, idx</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (idx) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> item + <span class="string">'年'</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> item + <span class="string">'月'</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> item + <span class="string">'日'</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> item + <span class="string">'时'</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> item + <span class="string">'分'</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> item + <span class="string">'秒'</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).join(<span class="string">''</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yearMonthRange = <span class="function"><span class="params">array</span> =&gt;</span> array.slice(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(timeKing(<span class="keyword">new</span> <span class="built_in">Date</span>())(addFrontZeroHandler)(yearMonthRange)(CNConjunction));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>获取今天的日期，然后返回数组[年，月，日]，其中月、日小于10的话就补0</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> yearMonthDayRange = <span class="function"><span class="params">array</span> =&gt;</span> array.slice(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(timeKing(<span class="keyword">new</span> <span class="built_in">Date</span>())(addFrontZeroHandler)(yearMonthDayRange)(<span class="function"><span class="params">array</span> =&gt;</span> array));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回今天加或减num天的日期数组。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todayPlusDaysObject = <span class="function"><span class="params">days</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  date.setDate(date.getDate() + days);</span><br><span class="line">  <span class="keyword">return</span> date;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(timeKing(todayPlusDaysObject(<span class="number">-10</span>))(addFrontZeroHandler)(yearMonthDayRange)(<span class="function"><span class="params">array</span> =&gt;</span> array));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回今天的字符串，如”20170201”</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(timeKing(<span class="keyword">new</span> <span class="built_in">Date</span>())(addFrontZeroHandler)(yearMonthDayRange)());</span><br></pre></td></tr></table></figure>
<h2 id="关于时间王中王的总结"><a href="#关于时间王中王的总结" class="headerlink" title="关于时间王中王的总结"></a>关于时间王中王的总结</h2><p>优点：</p>
<p>写起来思路似乎稍微清晰了一点。</p>
<p>每个阶段的处理函数只需要写一次。</p>
<p>缺点：</p>
<p>对使用者很不友好。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeKing()()()();<span class="comment">// 这4个坑你怎么知道哪个坑放啥</span></span><br></pre></td></tr></table></figure>
<p>要好好用王中王，基本上你必须和作者一样了解它，了解它有几个坑位，了解它每个坑位的输入和期待输出都是什么，了解我写的变换函数应该放在哪个坑位……emmmmmm</p>
<p>也许是我对函数式理解不够，才会有这种情况发生，所以下一阶段目标就是优化这个想法。</p>
</article><nav id="pagination"><div class="pagination clear-fix"><div class="page-next pull-right"><a href="/2018/04/10/NodeJS验证微信开发平台的token/"><span>NodeJS验证微信开发平台的token</span><i class="fa fa-chevron-right"></i></a></div></div></nav></div></div><footer><div id="footer-inner"><div class="social-icons"></div><p class="design-info">power by <a href="https://hexo.io" target="_blank">Hexo</a> | theme <a href="https://github.com/lazysheep666/terminal_theme" target="_blank">Teminal</a></p><p class="copyright">Copyright © 349989153 Blog 2018</p></div></footer><script src="/js/nav.js"></script><script src="/js/scroll.js"></script><script src="/js/index.js"></script></body></html>