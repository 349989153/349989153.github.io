<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>陆扬的个人博客 | 陆扬的个人博客</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><script src="/js/third-party/jquery.min.js">           </script><script src="/js/third-party/velocity.min.js">           </script><script src="/js/third-party/velocity.ui.min.js">           </script><link rel="icon" href="/img/favicon.ico"></head><body><nav id="nav-bar"><nav class="clear-fix" id="nav-container"><div class="pull-left" id="page-home"><a href="/">陆扬的个人博客</a></div><i class="fa fa-bars pull-right" id="toggle-nav" aria-hidden="true"></i><ul class="pull-right" id="navs"><li><a class="nav" href="/">Home</a></li><li><a class="nav" href="/about">About</a></li><li><a class="nav" href="/tags">Tags</a></li><li><a class="nav" href="/categories">Categories</a></li></ul></nav></nav><header id="header-info"><div id="header-container"><div id="site-info"><div id="terminal-pl"><div id="top-bar"><ul id="control"><li class="btn"></li><li class="btn"></li><li class="btn"></li></ul><div id="file-path"><i class="fa fa-folder folder-ic" aria-hidden="true"></i> 349989153 10 X 10</div></div><div id="code-pl">Last updated: 2018-04-10<br>349989153:~ Desktop$ <span class="code-pl-input">node home.js</span></div></div></div></div></header><div id="content-outer"><div id="content-inner"><div class="recent-post-item"><a class="article-title" href="/2018/04/10/《js函数式编程》读书笔记/">《js函数式编程》读书笔记</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>阅读《Javascript函数式编程》时做的笔记。</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/《js函数式编程》读书笔记/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#编程范式">编程范式</a><a class="article-tag" href="/tags/#读书">读书</a><a class="article-tag" href="/tags/#函数式">函数式</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/NodeJS验证微信开发平台的token/">NodeJS验证微信开发平台的token</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><a id="more"></a>
<hr>
<p>如果想在微信公众号上让用户体验更多的功能，而不仅仅是让公众号像机器人一样收发有限的信息，你就要成为微信平台开发者，自主开发web app。</p>
<p>成为微信平台开发者的第一步，是配置一台web服务器。<br>第二步，是配置相关的参数，通过微信的开发者验证，并且把你的服务器地址告知微信服务器。这里单讲第二步。</p>
<p>详细的配置步骤写在这里：<a href="http://mp.weixin.qq.com/wiki/17/2d4265491f12608cd170a95559800f2d.html" target="_blank" rel="noopener">微信公众平台开发者文档-接入指南</a></p>
<p>我个人提炼一下这个过程的话，就是微信服务器生成了一系列随机字符，放在url的query里，然后根据你写的服务器地址，发送request。而你的服务器在收到了request之后，分别取出query的各项参数，按照他的规则拼接啦，哈希变化，然后再返回（response）一个值给微信服务器。微信服务器收到之后，如果等于服务器本身设定的那个值，就通过验证。</p>
<p>后端语言有很多，php，python，node，还有windows平台的，我们这里用node。</p>
<p>下面是node源码，注意，该源码不是我原创，而是<a href="http://blog.csdn.net/nogrief/article/details/9774773" target="_blank" rel="noopener">csdn博客-NoGrief的博客</a> 的代码调试修改而来。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">"crypto"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sha1</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> md5sum = crypto.createHash(<span class="string">"sha1"</span>);</span><br><span class="line">  md5sum.update(str);</span><br><span class="line">  str = md5sum.digest(<span class="string">"hex"</span>);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validateToken</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> query = url.parse(req.url,<span class="literal">true</span>).query;</span><br><span class="line">  <span class="comment">//console.log("*** URL:" + req.url);</span></span><br><span class="line">  <span class="comment">//console.log(query);</span></span><br><span class="line">  <span class="keyword">var</span> signature = query.signature;</span><br><span class="line">  <span class="keyword">var</span> echostr = query.echostr;</span><br><span class="line">  <span class="keyword">var</span> timestamp = query[<span class="string">'timestamp'</span>];</span><br><span class="line">  <span class="keyword">var</span> nonce = query.nonce;</span><br><span class="line">  <span class="keyword">var</span> oriArray = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">  oriArray[<span class="number">0</span>] = nonce;</span><br><span class="line">  oriArray[<span class="number">1</span>] = timestamp;</span><br><span class="line">  oriArray[<span class="number">2</span>] = <span class="string">"*********"</span>;<span class="comment">//这里是你在微信开发者中心页面里填的token，而不是****</span></span><br><span class="line">  oriArray.sort();</span><br><span class="line">  <span class="keyword">var</span> original = oriArray.join(<span class="string">''</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Original str : "</span> + original);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Signature : "</span> + signature );</span><br><span class="line">  <span class="keyword">var</span> scyptoString = sha1(original);</span><br><span class="line">  <span class="keyword">if</span>(signature == scyptoString)&#123;</span><br><span class="line">    res.end(echostr);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Confirm and send echo back"</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">"false"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Failed!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> webSvr = http.createServer(validateToken);</span><br><span class="line">webSvr.listen(<span class="number">8000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Start validate"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码保存为tokenValidate.js或者任何你喜欢的名字。</p>
<p>你也许会问，为啥监听的是8000端口而不是80端口？<br>因为ubuntu下使用80端口很麻烦而且有安全问题，所以我上网查了资料，把8000端口的监听也改在80端口，这样一来，8000端口的信息会自动转到80端口去。<br>这是资料：<a href="http://stackoverflow.com/questions/16573668/best-practices-when-running-node-js-with-port-80-ubuntu-linode" target="_blank" rel="noopener">StackOverFlow-Best practices when running Node.js with port 80(Ubuntu/Lincode)</a></p>
<p>然后在微信开发者中心里点提交，就可以了。</p>
</div><div class="article-footer"><a class="article-more" href="/2018/04/10/NodeJS验证微信开发平台的token/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#node">node</a><a class="article-tag" href="/tags/#微信">微信</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/一道算法题（next smaller）/">一道算法题（next smaller）</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>挺有意思的一道题，这题的重点是数学理解。</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/一道算法题（next smaller）/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#算法">算法</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/三目（三元）运算符-的形式/">三目（三元）运算符??::的形式</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>一个三元运算符你能理解，多用几个呢？</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/三目（三元）运算符-的形式/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/Array-prototype-slice及其他Array方法/">Array.prototype.slice及其他Array方法</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>用Array的方法，对不是Array的东西做一些事情…</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/Array-prototype-slice及其他Array方法/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/echarts源码阅读修改/">echarts源码阅读修改</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>产品经理一个蛋疼的需求，着实让我研究了半天。</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/echarts源码阅读修改/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#echarts">echarts</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/阅读redux源码-combineReducer-js/">阅读redux源码--combineReducer.js</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>combineReducer是redux的2大核心之一，它为reducer提供了code split的功能，避免我们的reducer文件变得太长。</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/阅读redux源码-combineReducer-js/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#redux">redux</a><a class="article-tag" href="/tags/#源码">源码</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/阅读redux源码-createStore-js/">阅读redux源码--createStore.js</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>createStore是redux的2大核心之一，它创建了一个Redux store，并把state隐藏在闭包函数之中。</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/阅读redux源码-createStore-js/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#redux">redux</a><a class="article-tag" href="/tags/#源码">源码</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/阅读redux源码-bindActionCreators-js/">阅读redux源码--bindActionCreators.js</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>bindActionCreators是把action和dispatch绑定，这样本来2步走————创建action，然后dispatch————的代码，就变成了1步走————创建action之后马上dispatch。</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/阅读redux源码-bindActionCreators-js/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#redux">redux</a><a class="article-tag" href="/tags/#源码">源码</a></div></div></div><div class="recent-post-item"><a class="article-title" href="/2018/04/10/阅读redux源码-applyMiddleware-js/">阅读redux源码--applyMiddleware.js</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-10</time><div class="article-inner"><p>applyMiddleware.js就是升级dispatch方法，使之更强大。</p></div><div class="article-footer"><a class="article-more" href="/2018/04/10/阅读redux源码-applyMiddleware-js/#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/tags/#js">js</a><a class="article-tag" href="/tags/#redux">redux</a><a class="article-tag" href="/tags/#源码">源码</a></div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/archives/2018/page/2/">2</a><a class="extend next" rel="next" href="/archives/2018/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div id="footer-inner"><div class="social-icons"></div><p class="design-info">power by <a href="https://hexo.io" target="_blank">Hexo</a> | theme <a href="https://github.com/lazysheep666/terminal_theme" target="_blank">Teminal</a></p><p class="copyright">Copyright © 349989153 Blog 2018</p></div></footer><script src="/js/nav.js"></script><script src="/js/scroll.js"></script><script src="/js/index.js"></script></body></html>